services:
  - type: web
    name: CryptoQ
    env: python
    pythonVersion: 3.11.9
    buildCommand: "pip install --no-cache-dir --upgrade pip && pip install --no-cache-dir -r requirements.txt && cd CryptoQWeb && echo '=== Collecting static files ===' && python manage.py collectstatic --noinput --clear --verbosity 2 && echo '=== Verifying image files in staticfiles ===' && ls -la staticfiles/images/ | grep -E '(CryptoQ|FIRE|IIITKottayam)' && echo '=== Checking specific image files ===' && (test -f staticfiles/images/CryptoQ.jpeg && echo '✓ CryptoQ.jpeg found') || echo '✗ CryptoQ.jpeg missing' && (test -f staticfiles/images/FIRE.jpg && echo '✓ FIRE.jpg found') || echo '✗ FIRE.jpg missing' && (test -f staticfiles/images/IIITKottayam_Summer_Internship.jpg && echo '✓ IIITKottayam_Summer_Internship.jpg found') || echo '✗ IIITKottayam_Summer_Internship.jpg missing' && echo '=== Static files collection complete ===' && python manage.py migrate --noinput && cd .. && (python download_models.py || echo '⚠️ Model download failed, will download on first use')"
    startCommand: "cd CryptoQWeb && gunicorn CryptoQWeb.wsgi:application --bind 0.0.0.0:$PORT --workers 1 --timeout 180 --preload --access-logfile - --error-logfile -"
    healthCheckPath: "/health/"
    rootDir: .
    plan: starter
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: CryptoQWeb.settings
      - key: PYTHONPATH
        value: /opt/render/project/src/CryptoQWeb
      - key: PORT
        value: 8000
      - key: HF_HOME
        value: /opt/render/project/src/.cache/huggingface
      - key: HF_TOKEN
        value: your_huggingface_token_here
      - key: PYTHONUNBUFFERED
        value: 1